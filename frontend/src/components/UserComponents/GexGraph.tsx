import React from "react";
import { Bar } from "react-chartjs-2";

export interface GexGraphInput {
  stockPrice: number;
  callGEX: number[];
  callStrikes: number[];
  putGEX: number[];
  putStrikes: number[];
  ticker: string;
  exp: string;
}

const tempData = {
  callGEX: [
    6.589857548533473e-5, 0.0, -2.842170943040401e-10, 0.0003365670409039012,
    0.0007141684932321368, 0.004757491183227103, 0.003430785682212445,
    0.0028956009145986172, -2.7853275241795927e-8, 0.26520870051172096,
    0.08832205537601112, 0.13653701728344458, 0.05363661045976187,
    0.10102289820679289, 0.05237246028855225, 0.36641885571953026,
    0.1426637243184814, 0.17572045862834784, 0.13237713005764817,
    1.9262785539808647, -0.0, 0.3644860285589857, 0.3938262324254538,
    1.132026954877574, 1.3192561064556685, 1.1138121264764322,
    0.7405550113048776, 2.8640140499192057, 0.7714612380027575,
    104.63601543406753, 1.1306619333595336, 2.2235410961002344,
    3.387798056309066, 5.400094265013422, 11.455037362964049, 61.73379486824615,
    10.623505472366901, 26.890432135715514, 38.83931440014976,
    112.64727128668994, 29.56924971897479, 74.91689983680772,
    61.078539249308506, 113.43329023475235, 82.16880888589628,
    106.67984535350783, 109.68348383629589, 77.32229801833412,
    97.61382158451681, 242.75870400771282, 123.78974018446343,
    113.32357486595335, 27.643023736265704, 54.679168358955366,
    30.461826796979175, 125.5777273668235, 41.92416413403066,
    20.959759869376704, 0.02769019189940991, 121.76693399755578,
    0.11516879039996653, 97.15452057027507, 0.002285866004259063,
    19.371851467342438, 10.671533893478191, 3.0026876761812815,
    4.946192001797911, 0.6206844786071919, 1.0094378763858547,
    1.0349260100564472, 2.6448394011829857,
  ],
  callStrikes: [
    5.0, 10.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 65.0,
    70.0, 75.0, 80.0, 85.0, 90.0, 95.0, 100.0, 105.0, 110.0, 115.0, 120.0,
    125.0, 130.0, 135.0, 140.0, 145.0, 150.0, 155.0, 160.0, 165.0, 170.0, 175.0,
    180.0, 185.0, 190.0, 195.0, 200.0, 205.0, 210.0, 215.0, 220.0, 225.0, 230.0,
    235.0, 240.0, 245.0, 250.0, 255.0, 260.0, 265.0, 270.0, 275.0, 280.0, 285.0,
    290.0, 295.0, 300.0, 305.0, 310.0, 315.0, 320.0, 330.0, 340.0, 350.0, 360.0,
    370.0, 380.0, 390.0,
  ],
  stockPrice: 208.77999877929688,
  putGEX: [
    0.012811225787914132, 0.005541233468690093, 0.0003714880764116302,
    0.0022884879361320665, 1.4765056711996127e-5, 0.023067098356525928,
    0.0019557449971660534, 0.01814968483865309, 0.03616607229146862,
    0.09272881643429542, 0.009011660842550562, 0.18676789297414342,
    0.4262336573744585, 0.3076856667394434, 0.6467421910674731,
    0.31515712666407847, 0.3462688064326258, 0.7659641550167295,
    2.2360529280396335, 1.8589005585822882, 2.7385287465508945,
    1.9468474480366371, 0.8378655521390499, 3.1927906728101973,
    3.4214400127074995, 12.687166751019774, 5.543577962845436,
    6.599721454423335, 7.1522183559658, 123.4954763869478, 16.651776046603395,
    19.534495160922205, 34.44357420249844, 93.84628957434415, 44.07244134888799,
    172.70864087779893, 57.307151744403484, 95.08424178520158, 75.3279125121864,
    220.14633293835573, 75.41447817288827, 193.8334839348954,
    115.74511957903155, 157.38349817400632, 94.13744377923194,
    96.66099215721147, 41.11044958868604, 39.820851652905276,
    15.869431433088721, 26.161874930608064, 7.311975387906955,
    7.535546274013427, 1.0118128557223827e-7, 0.10381757597599517,
    0.11613931746978778, 0.013029683998411201, 0.0, 0.004156982527092623, 0.0,
    0.003085519750811727, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  ],
  putStrikes: [
    5.0, 10.0, 15.0, 20.0, 25.0, 30.0, 35.0, 40.0, 45.0, 50.0, 55.0, 60.0, 65.0,
    70.0, 75.0, 80.0, 85.0, 90.0, 95.0, 100.0, 105.0, 110.0, 115.0, 120.0,
    125.0, 130.0, 135.0, 140.0, 145.0, 150.0, 155.0, 160.0, 165.0, 170.0, 175.0,
    180.0, 185.0, 190.0, 195.0, 200.0, 205.0, 210.0, 215.0, 220.0, 225.0, 230.0,
    235.0, 240.0, 245.0, 250.0, 255.0, 260.0, 265.0, 270.0, 275.0, 280.0, 285.0,
    290.0, 300.0, 310.0, 315.0, 320.0, 330.0, 340.0, 350.0, 360.0, 370.0, 390.0,
  ],
};

function GexGraph(props: GexGraphInput) {
  // props = tempData;
  const allStrikes = Array.from(
    new Set([...new Set(props.callStrikes), ...new Set(props.putStrikes)])
  );

  const dataCalls = allStrikes.map((strike) => {
    const idx = props.callStrikes.indexOf(strike);
    return idx !== -1 ? props.callGEX[idx] : null;
  });

  const dataPuts = allStrikes.map((strike) => {
    const idx = props.putStrikes.indexOf(strike);
    return idx !== -1 ? -1 * props.putGEX[idx] : null;
  });

  const data = {
    labels: allStrikes,
    datasets: [
      {
        label: "Calls",
        data: dataCalls,
        backgroundColor: "rgb(0, 119, 255)",
      },
      {
        label: "Puts",
        data: dataPuts,
        backgroundColor: "rgb(255, 0, 195)",
      },
    ],
  };

  const config = {
    type: "bar",
    data: data,
    options: {
      indexAxis: "y",
      plugins: {
        annotation: {
          annotations: {
            stockPriceLine: {
              type: "line",
              yMin: props.stockPrice,
              yMax: props.stockPrice,
              borderColor: "black",
              borderWidth: 2,
              label: {
                display: true,
                content: `Stock: $${props.stockPrice.toFixed(2)}`,
                position: "end",
                backgroundColor: "rgba(0,0,0,0.7)",
                color: "white",
              },
            },
          },
        },
      },
      responsive: true,
      scales: {
        x: {
          stacked: true,
          reverse: true,
          ticks: {
            font: {
              weight: "bold",
            },
          },
          title: {
            display: true,
            text: "GEX",
            font: {
              size: 30,
            },
          },
        },
        y: {
          type: "linear",
          position: "left",
          stacked: true,
          ticks: {
            font: {
              weight: "bold",
            },
          },
          title: {
            display: true,
            text: "Strike",
            font: {
              size: 30,
            },
          },
        },
      },
    },
  };
  return (
    <div>
      <Bar data={data} options={config.options}></Bar>
    </div>
  );
}

export default GexGraph;
